<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <!-- Vue.js -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@0.379.0/dist/lucide.umd.js"></script>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>文章內容規劃器</title>
  <meta name="description" content="專業的內容規劃工具">

  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background-color: #f8fafc;
    }
    /* 自定義滾動條 */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
    ::-webkit-scrollbar-thumb { background: #888; border-radius: 10px; }
    ::-webkit-scrollbar-thumb:hover { background: #555; }

    /* 操作引導樣式 */
    .tutorial-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .tutorial-step {
      background: rgba(255, 255, 255, 0.1);
      padding: 16px;
      border-radius: 8px;
      margin: 8px;
      max-width: 300px;
      text-align: center;
    }
  </style>
  <script>
  tailwind.config = {
      darkMode: 'class',
      theme: {
          extend: {
              colors: {
                  dark: {
                      DEFAULT: '#1a1a1a',
                      100: '#2d2d2d',
                      200: '#404040'
                  }
              }
          }
      }
  }
  </script>
</head>
<body>
  <div id="app" class="min-h-screen p-4 md:p-8 bg-gray-50 flex items-center justify-center">
    <div class="max-w-4xl w-full bg-white shadow-xl rounded-lg p-6 md:p-8">
      <h1 class="text-3xl font-extrabold text-gray-900 mb-6 text-center">
        靜態內容規劃器
      </h1>

      <!-- 新增 / 編輯 表單 -->
      <div class="bg-gray-100 p-6 rounded-lg mb-8 shadow-inner">
        <h2 class="text-xl font-semibold text-gray-800 mb-4">
          {{ editingIndex !== null ? '編輯內容計劃' : '新增內容計劃' }}
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
          <!-- 主題 -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">主題標題</label>
            <input type="text" v-model="newPlan.title"
                   class="w-full p-2 border rounded-md focus:ring-blue-500 focus:border-blue-500">
          </div>
          <!-- 分類 -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">分類</label>
            <input type="text" v-model="newPlan.category"
                   class="w-full p-2 border rounded-md focus:ring-blue-500 focus:border-blue-500">
          </div>
          <!-- 關鍵字 -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">關鍵字 (以逗號分隔)</label>
            <input type="text" v-model="newPlan.keywordsInput"
                   class="w-full p-2 border rounded-md focus:ring-blue-500 focus:border-blue-500">
          </div>
          <!-- 撰寫狀態 -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">撰寫狀態</label>
            <select v-model="newPlan.status"
                    class="w-full p-2 border rounded-md focus:ring-blue-500 focus:border-blue-500">
              <option v-for="option in statusOptions" 
                      :key="option.id" 
                      :value="option.name">
                {{ option.name }}
              </option>
            </select>
          </div>
          <!-- 發佈平台 -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">發佈平台</label>
            <input type="text" v-model="newPlan.platform"
                   class="w-full p-2 border rounded-md focus:ring-blue-500 focus:border-blue-500">
          </div>
          <!-- 發佈日期 -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">發佈日期</label>
            <input type="date" v-model="newPlan.publishDate"
                   class="w-full p-2 border rounded-md focus:ring-blue-500 focus:border-blue-500">
          </div>
        </div>
        <!-- 摘要 -->
        <div class="mb-6">
          <label class="block text-sm font-medium text-gray-700 mb-1">摘要</label>
          <textarea rows="4" v-model="newPlan.summary"
                    class="w-full p-2 border rounded-md focus:ring-blue-500 focus:border-blue-500 resize-y"></textarea>
        </div>
        <!-- 新增 / 更新 & 取消 -->
        <div class="flex gap-4">
          <button @click="submitContentPlan"
                  :class="[
                    editingIndex !== null
                      ? 'bg-green-600 hover:bg-green-700'
                      : 'bg-blue-600 hover:bg-blue-700',
                    'flex-grow text-white py-2 px-4 rounded-md shadow-lg transition transform hover:-translate-y-0.5 hover:scale-105'
                  ]">
            {{ editingIndex !== null ? '更新內容計劃' : '新增內容計劃' }}
          </button>
          <button v-if="editingIndex !== null" @click="cancelEdit"
                  class="flex-grow bg-gray-400 text-white py-2 px-4 rounded-md shadow-lg hover:bg-gray-500 transition transform hover:-translate-y-0.5 hover:scale-105">
            取消編輯
          </button>
        </div>
      </div>

      <!-- Tabs 與「設定面板」切換按鈕 -->
      <div class="mb-6 border-b border-gray-200">
        <nav class="-mb-px flex space-x-4 md:space-x-8" aria-label="Tabs">
          <button v-for="tab in tabs" :key="tab.value" @click="activeTab = tab.value"
                  :class="[
                    activeTab === tab.value
                      ? 'border-blue-500 text-blue-600'
                      : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300',
                    'whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm md:text-base rounded-t-lg transition'
                  ]">
            {{ tab.name }} ({{ getContentCount(tab.value) }})
          </button>
        </nav>
        <div class="flex justify-end mt-2">
          <button @click="showSettings = !showSettings"
                  class="text-sm text-gray-600 hover:text-gray-800">
            {{ showSettings ? '關閉設定' : '編輯狀態選項' }}
          </button>
        </div>
      </div>

      <!-- 文章列表 -->
      <div v-if="filteredContentPlans.length === 0" class="text-center text-gray-500 py-10">
        <p>目前沒有符合條件的內容計劃。</p>
      </div>
      <div class="grid grid-cols-1 gap-6" v-else>
        <div v-for="(plan, idx) in filteredContentPlans" :key="idx"
             class="bg-white border rounded-lg shadow-sm p-5 hover:shadow-md transition flex flex-col md:flex-row">
          <div class="flex-grow">
            <h3 class="text-xl font-bold mb-2">{{ plan.title }}</h3>
            <p class="text-sm text-gray-600 mb-3">
              <span class="inline-flex items-center">
                <i data-lucide="tag" class="w-4 h-4 mr-1"></i>分類: {{ plan.category }}
              </span>
              <span v-if="plan.keywords && plan.keywords.length" class="ml-4 inline-flex items-center">
                <i data-lucide="key" class="w-4 h-4 mr-1"></i>關鍵字: {{ plan.keywords.join(', ') }}
              </span>
            </p>
            <p class="text-gray-700 mb-4">{{ plan.summary }}</p>
          </div>
          <div class="md:ml-6 md:w-48 flex-shrink-0 mt-4 md:mt-0 pt-4 md:pt-0 border-t md:border-t-0 md:border-l border-gray-200">
            <div class="pl-0 md:pl-6">
              <p class="text-sm mb-2 flex items-center">
                <i data-lucide="workflow" class="w-4 h-4 mr-2"></i>
                狀態:
                <span :class="getStatusBadgeClass(plan.status)">{{ plan.status }}</span>
              </p>
              <p class="text-sm mb-2 flex items-center">
                <i data-lucide="monitor" class="w-4 h-4 mr-2"></i>平台: {{ plan.platform }}
              </p>
              <p class="text-sm mb-2 flex items-center">
                <i data-lucide="calendar" class="w-4 h-4 mr-2"></i>發佈日期: {{ plan.publishDate }}
              </p>
              <div class="flex gap-2 mt-3">
                <button @click="editContentPlan(idx)"
                        class="inline-flex items-center px-3 py-1 bg-blue-100 text-blue-700 rounded-md hover:bg-blue-200">
                  <i data-lucide="edit" class="w-4 h-4 mr-1"></i>編輯
                </button>
                <button @click="deleteContentPlan(idx)"
                        class="inline-flex items-center px-3 py-1 bg-red-100 text-red-700 rounded-md hover:bg-red-200">
                  <i data-lucide="trash-2" class="w-4 h-4 mr-1"></i>刪除
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 狀態選項設定 面板 -->
      <div v-if="showSettings" class="mb-6">
        <!-- 狀態選項 -->
        <div class="mb-8">
          <h4 class="text-lg font-medium text-gray-700 mb-2">狀態選項設定</h4>
          <div class="space-y-2">
            <div v-for="(opt, i) in statusOptions" :key="opt.id" class="flex items-center gap-2">
              <input type="text" v-model="opt.name"
                     class="flex-grow p-2 border rounded-md">
              <button @click="removeStatus(i)" class="text-red-500 hover:text-red-700">
                <i data-lucide="trash-2" class="w-4 h-4"></i>
              </button>
            </div>
            <button @click="addStatus"
                    class="w-full py-2 px-4 border-2 border-dashed border-gray-300 rounded-md hover:border-gray-400 hover:text-gray-700 transition">
              + 新增狀態選項
            </button>
          </div>
        </div>

        <!-- 種類選項 -->
        <div class="mb-8">
          <h4 class="text-lg font-medium text-gray-700 mb-2">種類選項設定</h4>
          <div class="space-y-2">
            <div v-for="(opt, i) in categoryOptions" :key="opt.id" class="flex items-center gap-2">
              <input type="text" v-model="opt.name"
                     class="flex-grow p-2 border rounded-md">
              <button @click="removeCategory(i)" class="text-red-500 hover:text-red-700">
                <i data-lucide="trash-2" class="w-4 h-4"></i>
              </button>
            </div>
            <button @click="addCategory"
                    class="w-full py-2 px-4 border-2 border-dashed border-gray-300 rounded-md hover:border-gray-400 hover:text-gray-700 transition">
              + 新增種類選項
            </button>
          </div>
        </div>

        <!-- 發布平台選項 -->
        <div class="mb-8">
          <h4 class="text-lg font-medium text-gray-700 mb-2">發布平台設定</h4>
          <div class="space-y-2">
            <div v-for="(opt, i) in platformOptions" :key="opt.id" class="flex items-center gap-2">
              <input type="text" v-model="opt.name"
                     class="flex-grow p-2 border rounded-md">
              <button @click="removePlatform(i)" class="text-red-500 hover:text-red-700">
                <i data-lucide="trash-2" class="w-4 h-4"></i>
              </button>
            </div>
            <button @click="addPlatform"
                    class="w-full py-2 px-4 border-2 border-dashed border-gray-300 rounded-md hover:border-gray-400 hover:text-gray-700 transition">
              + 新增平台選項
            </button>
          </div>
        </div>

        <!-- 儲存按鈕 -->
        <div class="mt-4">
          <button @click="saveSettings"
                  class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
            儲存所有設定
          </button>
        </div>
      </div>

      <!-- 添加深色模式支持 -->
      <div class="dark:bg-gray-800" :class="{ 'dark': isDarkMode }">
        <!-- 切換按鈕 -->
        <button @click="toggleDarkMode" class="fixed top-4 right-4">
          <i data-lucide="sun" v-if="isDarkMode"></i>
          <i data-lucide="moon" v-else></i>
        </button>
      </div>

      <!-- 添加操作引導 -->
      <div v-if="showTutorial" class="tutorial-overlay">
        <div class="tutorial-step" v-for="step in tutorialSteps">
          {{ step.description }}
        </div>
      </div>
    </div>
  </div>

  <script>
  // NotificationSystem class
  class NotificationSystem {
    constructor() {
      this.createContainer();
    }

    createContainer() {
      this.container = document.createElement('div');
      this.container.className = 'fixed top-4 right-4 z-50 space-y-2';
      document.body.appendChild(this.container);
    }

    show(message, type = 'info') {
      const notification = document.createElement('div');
      const bgColor = this.getTypeClass(type);
      notification.className = `${bgColor} px-4 py-2 rounded-lg shadow-lg text-white transform transition-all duration-300`;
      notification.textContent = message;
      this.container.appendChild(notification);
      setTimeout(() => {
        notification.style.opacity = '0';
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }

    getTypeClass(type) {
      const classes = {
        success: 'bg-green-500',
        error: 'bg-red-500',
        info: 'bg-blue-500',
        warning: 'bg-yellow-500'
      };
      return classes[type] || classes.info;
    }
  }

  // ContentStore class
  class ContentStore {
    constructor() {
      this.storageKey = 'contentPlans';
    }

    async save(data) {
      try {
        localStorage.setItem(this.storageKey, JSON.stringify(data));
        return true;
      } catch (error) {
        console.error('儲存失敗:', error);
        return false;
      }
    }

    async load() {
      try {
        const data = localStorage.getItem(this.storageKey);
        return data ? JSON.parse(data) : [];
      } catch (error) {
        console.error('載入失敗:', error);
        return [];
      }
    }
  }

  // FormValidator class
  class FormValidator {
    static validate(data) {
      const errors = [];
      if (!data.title?.trim()) errors.push('標題不能為空');
      if (!data.category?.trim()) errors.push('分類不能為空');
      if (!data.status?.trim()) errors.push('狀態不能為空');
      if (!data.summary?.trim()) errors.push('摘要不能為空');
      return { isValid: errors.length === 0, errors };
    }
  }

  // SettingsStore class
  class SettingsStore {
    constructor() {
      this.prefix = 'settings_';
    }

    async save(key, value) {
      try {
        localStorage.setItem(this.prefix + key, JSON.stringify(value));
        return true;
      } catch (error) {
        console.error('儲存設定失敗:', error);
        return false;
      }
    }

    get(key) {
      try {
        const value = localStorage.getItem(this.prefix + key);
        return value ? JSON.parse(value) : null;
      } catch (error) {
        console.error('讀取設定失敗:', error);
        return null;
      }
    }
  }

  class UXManager {
    constructor() {
        this.darkModeKey = 'darkMode';
        this.initDarkMode();
        this.initShortcuts();
    }

    initDarkMode() {
        const isDark = localStorage.getItem(this.darkModeKey) === 'true';
        if (isDark) {
            document.documentElement.classList.add('dark');
        }
    }

    toggleDarkMode() {
        const isDark = document.documentElement.classList.toggle('dark');
        localStorage.setItem(this.darkModeKey, isDark);
        return isDark;
    }

    initShortcuts() {
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && shortcuts[e.key]) {
                e.preventDefault();
                shortcuts[e.key]();
            }
        });
    }
}

class SecurityManager {
    constructor() {
        this.encryptionKey = 'your-secret-key';
    }

    async backup() {
        return {
            data: contentPlans.value,
            settings: {
                status: statusOptions.value,
                category: categoryOptions.value,
                platform: platformOptions.value
            },
            timestamp: new Date().toISOString()
        };
    }

    async encrypt(data) {
        try {
            // Simple encryption for demo
            return {
                data: btoa(JSON.stringify(data)),
                iv: new Date().getTime()
            };
        } catch (error) {
            console.error('Encryption failed:', error);
            throw error;
        }
    }

    async decrypt(data, iv) {
        try {
            // Simple decryption for demo
            return JSON.parse(atob(data));
        } catch (error) {
            console.error('Decryption failed:', error);
            throw error;
        }
    }

    async restore(data) {
        if (!this.validateBackup(data)) {
            throw new Error('Invalid backup data');
        }
        return data;
    }

    validateBackup(data) {
        return data &&
               Array.isArray(data.data) &&
               data.settings &&
               data.timestamp;
    }
}

    const { createApp, ref, computed, onMounted, watch, nextTick } = Vue;

    createApp({
      setup() {
        const store = new ContentStore();
        const notifications = new NotificationSystem();
        const settingsStore = new SettingsStore();

        // 核心資料
        const contentPlans = ref([]);
        const activeTab     = ref('所有文章');
        const editingIndex  = ref(null);

        // 新增/編輯表單
        const newPlan = ref({
          title: '',
          category: '',
          keywordsInput: '',
          status: '構思中',
          platform: '',
          publishDate: '',
          summary: ''
        });

        // 分頁
        const initializeTabs = () => {
          const savedStatus = settingsStore.get('statusOptions') || [
            { id: 1, name: '構思中' },
            { id: 2, name: '撰寫中' },
            { id: 3, name: '已完成' }
          ];
          
          return [
            { name: '所有文章', value: '所有文章' },
            ...savedStatus.map(opt => ({
              name: opt.name,
              value: opt.name
            }))
          ];
        };
        const tabs = ref(initializeTabs());

        // 控制設定面板
        const showSettings    = ref(false);
        // 狀態選項列表
        const statusOptions   = ref(settingsStore.get('statusOptions') || [
          { id: 1, name: '構思中' },
          { id: 2, name: '撰寫中' },
          { id: 3, name: '已完成' }
        ]);
        // 以下兩項目前尚未在模板中使用，但預留擴充
        const categoryOptions = ref(settingsStore.get('categoryOptions') || []);
        const platformOptions = ref(settingsStore.get('platformOptions') || []);

        // 篩選
        const filteredContentPlans = computed(() => {
          if (activeTab.value === '所有文章') return contentPlans.value;
          return contentPlans.value.filter(p => p.status === activeTab.value);
        });

        // 數量
        const getContentCount = status => {
          return status === '所有文章'
            ? contentPlans.value.length
            : contentPlans.value.filter(p => p.status === status).length;
        };

        // 提交
        const submitContentPlan = async () => {
          const v = FormValidator.validate(newPlan.value);
          if (!v.isValid) {
            v.errors.forEach(e => notifications.show(e, 'error'));
            return;
          }
          try {
            if (editingIndex.value !== null) {
              contentPlans.value[editingIndex.value] = { ...newPlan.value };
              notifications.show('內容更新成功！', 'success');
            } else {
              contentPlans.value.push({ ...newPlan.value });
              notifications.show('內容新增成功！', 'success');
            }
            await store.save(contentPlans.value);
            resetForm();
          } catch (err) {
            console.error(err);
            notifications.show('操作失敗，請稍後再試', 'error');
          }
        };

        // 編輯
        const editContentPlan = idx => {
          editingIndex.value = idx;
          const p = contentPlans.value[idx];
          newPlan.value = {
            ...p,
            keywordsInput: p.keywords ? p.keywords.join(', ') : ''
          };
          window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        // 取消
        const cancelEdit = () => {
          resetForm();
          alert('已取消編輯。');
        };

        // 重置
        const resetForm = () => {
          newPlan.value = {
            title: '',
            category: '',
            keywordsInput: '',
            status: '構思中',
            platform: '',
            publishDate: '',
            summary: ''
          };
          editingIndex.value = null;
        };

        // 刪除
        const deleteContentPlan = idx => {
          showConfirm('確定要刪除這項內容計劃嗎？', async () => {
            contentPlans.value.splice(idx, 1);
            await store.save(contentPlans.value);
            resetForm();
            alert('內容計劃已刪除！');
          });
        };

        // Badge 樣式
        const getStatusBadgeClass = status => {
          switch (status) {
            case '構思中':
              return 'inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800';
            case '撰寫中':
              return 'inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800';
            case '已完成':
              return 'inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800';
            default:
              return 'inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800';
          }
        };

        // 匯出
        const exportData = () => {
          try {
            const data = contentPlans.value.length
              ? contentPlans.value
              : store.getTemplates();
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `content-plans-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            a.remove();
            URL.revokeObjectURL(url);
            notifications.show('資料匯出成功！', 'success');
          } catch (e) {
            console.error(e);
            notifications.show('資料匯出失敗，請稍後再試', 'error');
          }
        };

        // 匯入
        const importData = event => {
          const file = event.target.files[0];
          if (!file) return;
          const reader = new FileReader();
          reader.onload = e => {
            try {
              const arr = JSON.parse(e.target.result);
              if (!Array.isArray(arr)) throw new Error();
              showConfirm(`確定要匯入 ${arr.length} 筆資料嗎？`, async () => {
                contentPlans.value = arr;
                await store.save(arr);
                notifications.show('資料匯入成功！', 'success');
              });
            } catch {
              notifications.show('檔案格式錯誤，請確認是否為正確的 JSON 檔案', 'error');
            }
          };
          reader.readAsText(file);
          event.target.value = '';
        };

        // 添加深色模式支持
        const uxManager = new UXManager();
        const securityManager = new SecurityManager();

        // 深色模式狀態
        const isDarkMode = ref(localStorage.getItem('darkMode') === 'true');

        // 切換深色模式
        const toggleDarkMode = () => {
            isDarkMode.value = uxManager.toggleDarkMode();
        };

        // 安全備份
        const secureExport = async () => {
            try {
                const backupData = await securityManager.backup();
                const encrypted = await securityManager.encrypt(backupData);
                
                const blob = new Blob([JSON.stringify(encrypted)], { 
                    type: 'application/json' 
                });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `secure-backup-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                a.remove();
                URL.revokeObjectURL(url);
                
                notifications.show('安全備份已完成！', 'success');
            } catch (e) {
                console.error(e);
                notifications.show('備份失敗，請稍後再試', 'error');
            }
        };

        // 安全還原
        const secureImport = async (event) => {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = async (e) => {
                try {
                    const encryptedData = JSON.parse(e.target.result);
                    const decrypted = await securityManager.decrypt(
                        encryptedData.data,
                        encryptedData.iv
                    );
                    
                    const restored = await securityManager.restore(decrypted);
                    
                    contentPlans.value = restored.data;
                    statusOptions.value = restored.settings.status;
                    categoryOptions.value = restored.settings.category;
                    platformOptions.value = restored.settings.platform;
                    
                    await store.save(contentPlans.value);
                    await settingsStore.save('statusOptions', statusOptions.value);
                    
                    notifications.show('資料已安全還原！', 'success');
                } catch (error) {
                    console.error(error);
                    notifications.show('還原失敗，請確認檔案格式是否正確', 'error');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        };

        // 設定面板：增刪
        const addOption = type => {
          if (type === 'status') {
            statusOptions.value.push({ id: Date.now(), name: '' });
          }
        };
        const removeOption = (type, idx) => {
          if (type === 'status') {
            statusOptions.value.splice(idx, 1);
          }
        };
        // 設定面板：儲存設定
        const saveSettings = async () => {
          try {
            // 過濾掉空值
            statusOptions.value = statusOptions.value.filter(opt => opt.name.trim());
            
            // 儲存設定
            await settingsStore.save('statusOptions', statusOptions.value);
            
            // 更新 tabs
            tabs.value = [
              { name: '所有文章', value: '所有文章' },
              ...statusOptions.value.map(opt => ({
                name: opt.name,
                value: opt.name
              }))
            ];
            
            // 如果目前選中的 tab 不在新的選項中，切換到「所有文章」
            if (!tabs.value.find(tab => tab.value === activeTab.value)) {
              activeTab.value = '所有文章';
            }

            // 如果目前編輯表單的狀態不在新的選項中，設為第一個可用的狀態
            if (statusOptions.value.length > 0 && !statusOptions.value.find(opt => opt.name === newPlan.value.status)) {
              newPlan.value.status = statusOptions.value[0].name;
            }
            
            notifications.show('設定已儲存！', 'success');
            showSettings.value = false;  // 儲存後關閉設定面板
          } catch (e) {
            console.error(e);
            notifications.show('儲存設定失敗', 'error');
          }
        };

        // 添加共享與協作功能
        const sharing = {
          generateShareLink: async (contentId) => {
            // 產生分享連結
          },
          
          enableCollaboration: async (contentId) => {
            // 啟用即時協作
          }
        };

        // 添加虛擬滾動
        const virtualScroll = {
          itemHeight: 100,
          visibleItems: computed(() => {
            const start = Math.floor(scrollTop.value / itemHeight);
            const count = Math.ceil(viewportHeight.value / itemHeight);
            return filteredContentPlans.value.slice(start, start + count);
          })
        };

        // 添加搜尋優化
        const search = {
          index: null,
          async initialize() {
            // 建立搜尋索引
          },
          async search(query) {
            // 執行最佳化搜尋
          }
        };

        // 首次載入
        onMounted(async () => {
          const loaded = await store.load();
          contentPlans.value = loaded.length ? loaded : [];
          nextTick(() => window.lucide.createIcons());
        });

        // 監聽 icons
        watch(contentPlans, () => {
          nextTick(() => window.lucide.createIcons());
        }, { deep: true });

        return {
          contentPlans,
          activeTab,
          tabs,
          newPlan,
          editingIndex,
          filteredContentPlans,
          submitContentPlan,
          editContentPlan,
          cancelEdit,
          deleteContentPlan,
          getStatusBadgeClass,
          getContentCount,
          exportData,
          importData,
          showSettings,
          statusOptions,
          addOption,
          removeOption,
          saveSettings
        };
      }
    }).mount('#app');

    // 自訂 alert / confirm
    function alert(message) {
      const notification = new NotificationSystem();
      notification.show(message, 'info');
    }

    function showConfirm(message, onConfirm) {
      if (window.confirm(message)) {
        onConfirm();
      }
    }

    // 添加快捷鍵支援
    const shortcuts = {
      'ctrl+n': () => createNew(),
      'ctrl+s': () => save(),
      'ctrl+f': () => focusSearch()
    };
  </script>
</body>
</html>
