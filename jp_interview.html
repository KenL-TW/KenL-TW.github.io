import React, { useState, useEffect } from 'react';
import { initializeApp } from 'firebase/app';
import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signOut } from 'firebase/auth';
import { getFirestore } from 'firebase/firestore'; // Although not fully used for data persistence in this frontend-only app, good to include.
import { Book, FileText, Send, User, Calendar, MessageSquare, Briefcase, GitPullRequest, Award, Lightbulb, UserCheck, Mail, Clock, CheckCircle, GraduationCap, Zap, PhoneCall, LogIn, LogOut, User as UserIcon } from 'lucide-react'; // Icons for better UX and new ones for landing page

// Define global variables, as they would be provided in a Canvas environment
const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_AUTH_DOMAIN",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_STORAGE_BUCKET",
  messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
  appId: "YOUR_APP_ID"
};
const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

function App() {
  const [currentPage, setCurrentPage] = useState('home');
  const [resumeText, setResumeText] = useState('');
  const [aiSummary, setAiSummary] = useState('');
  const [isLoadingSummary, setIsLoadingSummary] = useState(false);
  const [consultationForm, setConsultationForm] = useState({
    name: '',
    email: '',
    topic: '面試技巧',
    date: '',
    time: ''
  });
  const [showConsultationConfirmation, setShowConsultationConfirmation] = useState(false);
  const [userId, setUserId] = useState('Loading User ID...'); // State to hold the user ID
  const [user, setUser] = useState(null); // Firebase User object
  const [auth, setAuth] = useState(null); // Firebase Auth instance

  // Firebase initialization and authentication
  useEffect(() => {
    const app = initializeApp(firebaseConfig);
    const authInstance = getAuth(app);
    setAuth(authInstance); // Store auth instance in state

    const unsubscribe = onAuthStateChanged(authInstance, async (currentUser) => {
      if (currentUser) {
        setUser(currentUser);
        setUserId(currentUser.uid);
      } else {
        setUser(null);
        setUserId("未登入"); // Reset user ID if not logged in
        // If initialAuthToken exists, try custom token sign-in.
        // Otherwise, rely on explicit Google sign-in.
        if (initialAuthToken) {
          try {
            await signInWithCustomToken(authInstance, initialAuthToken);
            // User state will be updated by the onAuthStateChanged listener
          } catch (error) {
            console.error("Firebase custom token authentication error:", error);
            // If custom token fails, user remains null, prompting for Google login.
          }
        }
      }
    });

    return () => unsubscribe(); // Cleanup the auth listener
  }, []);

  const handleGoogleSignIn = async () => {
    if (!auth) return;
    const provider = new GoogleAuthProvider();
    // 移除 setCustomParameters，以避免在某些環境下產生 auth/unauthorized-domain 錯誤
    // provider.setCustomParameters({
    //   hd: `${appId}.app.goo.gle` // Use appId to construct a valid domain hint for Canvas
    // });
    try {
      await signInWithPopup(auth, provider);
      // User state will be updated by the onAuthStateChanged listener
    } catch (error) {
      console.error("Google Sign-In error:", error);
      // Handle specific errors, e.g., popup closed by user
      if (error.code === 'auth/popup-closed-by-user') {
        // User closed the popup, do nothing or show a message
      } else if (error.code === 'auth/cancelled-popup-request') {
        // Another popup was already open
      } else {
        // Other errors
      }
    }
  };

  const handleSignOut = async () => {
    if (!auth) return;
    try {
      await signOut(auth);
      // User state will be updated by the onAuthStateChanged listener
      setCurrentPage('home'); // Go back to home page after logout
    } catch (error) {
      console.error("Sign Out error:", error);
    }
  };

  const handleFileUpload = (event) => {
    const file = event.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        setResumeText(e.target.result);
      };
      reader.readAsText(file);
    }
  };

  const simulateAiSummary = () => {
    if (!resumeText) {
      setAiSummary('請先上傳履歷文件！');
      return;
    }

    setIsLoadingSummary(true);
    setAiSummary('');

    // Simulate API call to LLM
    // In a real application, you would make a fetch call to your backend here
    // let chatHistory = [];
    // chatHistory.push({ role: "user", parts: [{ text: `Summarize this resume: ${resumeText}` }] });
    // const payload = { contents: chatHistory };
    // const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
    // const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
    // const result = await response.json();
    // const text = result.candidates[0].content.parts[0].text;

    setTimeout(() => {
      // Mock summary based on input
      const lines = resumeText.split('\n').filter(line => line.trim() !== '');
      let mockSummary = `AI 摘要 (模擬):\n\n`;
      mockSummary += `此履歷內容包含以下關鍵資訊：\n`;
      if (lines.length > 0) {
        mockSummary += `- 姓名與聯絡方式：${lines[0].substring(0, Math.min(lines[0].length, 30))}...\n`;
      }
      if (lines.length > 1) {
        mockSummary += `- 主要經歷：${lines[1].substring(0, Math.min(lines[1].length, 50))}...\n`;
      }
      if (lines.length > 2) {
        mockSummary += `- 相關技能：${lines[2].substring(0, Math.min(lines[2].length, 40))}...\n`;
      }
      mockSummary += `\n請注意，這是一個模擬摘要。實際的 AI 摘要會更精確地分析履歷內容。建議您仔細審閱以下內容。\n`;
      setAiSummary(mockSummary);
      setIsLoadingSummary(false);
    }, 2000); // Simulate network delay
  };

  const handleConsultationFormChange = (e) => {
    const { name, value } = e.target;
    setConsultationForm(prevState => ({
      ...prevState,
      [name]: value
    }));
  };

  const handleConsultationSubmit = (e) => {
    e.preventDefault();
    // In a real application, you would send this data to a backend or a third-party booking service
    console.log('諮詢預約表單提交:', consultationForm);
    setShowConsultationConfirmation(true);
    // Reset form after submission
    setConsultationForm({
      name: '',
      email: '',
      topic: '面試技巧',
      date: '',
      time: ''
    });
    setTimeout(() => setShowConsultationConfirmation(false), 5000); // Hide confirmation after 5 seconds
  };

  const renderContent = () => {
    if (!user) {
      return (
        <div className="flex flex-col items-center justify-center h-full text-center p-6 bg-gradient-to-br from-blue-50 to-indigo-100 rounded-lg shadow-xl">
          <h2 className="text-3xl font-bold text-gray-800 mb-6">請先登入 Google 帳號以開始使用</h2>
          <p className="text-gray-600 mb-8 max-w-lg">
            登入後即可解鎖所有日文面試準備功能、AI 履歷審核及免費諮詢預約。
          </p>
          <button
            onClick={handleGoogleSignIn}
            className="px-8 py-4 bg-red-600 text-white font-semibold rounded-full shadow-lg hover:bg-red-700 transition-all duration-300 transform hover:scale-105 flex items-center space-x-3"
          >
            <LogIn className="w-5 h-5" />
            <span>使用 Google 登入</span>
          </button>
        </div>
      );
    }

    switch (currentPage) {
      case 'home':
        return (
          <div className="flex flex-col items-center justify-center text-center p-6 bg-gradient-to-br from-blue-50 to-indigo-100 rounded-lg shadow-xl w-full">
            {/* Hero Section */}
            <div className="mb-12 py-8 px-4 sm:px-6 lg:px-8">
              <h2 className="text-4xl sm:text-5xl lg:text-6xl font-extrabold text-gray-900 leading-tight mb-4 animate-fade-in-up">
                <span className="text-indigo-600">日文面試成功，</span>
                <br className="sm:hidden" />
                <span className="inline-block mt-2 sm:mt-0">從這裡開始！</span>
              </h2>
              <p className="text-lg sm:text-xl text-gray-700 mb-8 max-w-3xl mx-auto animate-fade-in-up delay-100">
                一站式面試準備平台：**精華掌握、AI履歷、專業諮詢**，助您征服日文職場。
              </p>
              <div className="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4 justify-center animate-fade-in-up delay-200">
                <button
                  onClick={() => setCurrentPage('interview-prep')}
                  className="px-8 py-4 bg-indigo-600 text-white font-semibold rounded-full shadow-lg hover:bg-indigo-700 transition-all duration-300 transform hover:scale-105 flex items-center justify-center space-x-2 min-w-[200px]"
                >
                  <Briefcase className="w-5 h-5" />
                  <span>面試準備</span>
                </button>
                <button
                  onClick={() => setCurrentPage('resume-review')}
                  className="px-8 py-4 bg-blue-600 text-white font-semibold rounded-full shadow-lg hover:bg-blue-700 transition-all duration-300 transform hover:scale-105 flex items-center justify-center space-x-2 min-w-[200px]"
                >
                  <FileText className="w-5 h-5" />
                  <span>履歷審核</span>
                </button>
              </div>
            </div>

            {/* Feature Overview Section */}
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 w-full max-w-6xl p-4">
              {/* Feature Card 1: Interview Prep */}
              <div className="bg-white rounded-lg shadow-md p-6 transform transition-transform hover:scale-105 duration-300 flex flex-col items-center justify-center text-center border-b-4 border-indigo-500">
                <div className="p-4 rounded-full bg-indigo-100 text-indigo-600 mb-4">
                  <GraduationCap className="w-8 h-8" />
                </div>
                <h3 className="text-xl font-semibold text-gray-800 mb-2">面試精華</h3>
                <p className="text-gray-600 text-sm mb-4">
                  涵蓋常見問題、禮儀、產業重點，助您全面掌握面試技巧。
                </p>
                <button
                  onClick={() => setCurrentPage('interview-prep')}
                  className="text-indigo-600 hover:text-indigo-800 font-medium text-sm flex items-center space-x-1"
                >
                  <span>了解更多</span>
                  <ArrowRight className="w-4 h-4" />
                </button>
              </div>

              {/* Feature Card 2: Vocabulary */}
              <div className="bg-white rounded-lg shadow-md p-6 transform transition-transform hover:scale-105 duration-300 flex flex-col items-center justify-center text-center border-b-4 border-purple-500">
                <div className="p-4 rounded-full bg-purple-100 text-purple-600 mb-4">
                  <Book className="w-8 h-8" />
                </div>
                <h3 className="text-xl font-semibold text-gray-800 mb-2">用詞用具</h3>
                <p className="text-gray-600 text-sm mb-4">
                  精選敬語與商務詞彙，讓您的日文表達更專業流暢。
                </p>
                <button
                  onClick={() => setCurrentPage('vocabulary')}
                  className="text-purple-600 hover:text-purple-800 font-medium text-sm flex items-center space-x-1"
                >
                  <span>了解更多</span>
                  <ArrowRight className="w-4 h-4" />
                </button>
              </div>

              {/* Feature Card 3: AI Resume Review */}
              <div className="bg-white rounded-lg shadow-md p-6 transform transition-transform hover:scale-105 duration-300 flex flex-col items-center justify-center text-center border-b-4 border-blue-500">
                <div className="p-4 rounded-full bg-blue-100 text-blue-600 mb-4">
                  <Zap className="w-8 h-8" />
                </div>
                <h3 className="text-xl font-semibold text-gray-800 mb-2">AI 履歷審核</h3>
                <p className="text-gray-600 text-sm mb-4">
                  上傳履歷，AI 智能摘要，快速檢視您的日文履歷。
                </p>
                <button
                  onClick={() => setCurrentPage('resume-review')}
                  className="text-blue-600 hover:text-blue-800 font-medium text-sm flex items-center space-x-1"
                >
                  <span>了解更多</span>
                  <ArrowRight className="w-4 h-4" />
                </button>
              </div>

              {/* Feature Card 4: Free Consultation */}
              <div className="bg-white rounded-lg shadow-md p-6 transform transition-transform hover:scale-105 duration-300 flex flex-col items-center justify-center text-center border-b-4 border-green-500">
                <div className="p-4 rounded-full bg-green-100 text-green-600 mb-4">
                  <PhoneCall className="w-8 h-8" />
                </div>
                <h3 className="text-xl font-semibold text-gray-800 mb-2">免費諮詢</h3>
                <p className="text-gray-600 text-sm mb-4">
                  預約 15 分鐘一對一諮詢，獲取專業顧問的個人化建議。
                </p>
                <button
                  onClick={() => setCurrentPage('consultation')}
                  className="text-green-600 hover:text-green-800 font-medium text-sm flex items-center space-x-1"
                >
                  <span>了解更多</span>
                  <ArrowRight className="w-4 h-4" />
                </button>
              </div>
            </div>
          </div>
        );
      case 'interview-prep':
        return (
          <div className="p-6 bg-white rounded-lg shadow-lg">
            <h2 className="text-3xl font-bold text-gray-800 mb-6 flex items-center space-x-3">
              <Briefcase className="w-8 h-8 text-indigo-600" />
              <span>日文面試準備精華</span>
            </h2>
            <p className="text-gray-600 mb-6">掌握日文面試技巧，提升您的成功率！</p>

            <div className="space-y-8">
              {/* Common Questions */}
              <div className="bg-blue-50 p-6 rounded-lg shadow-md border-l-4 border-blue-500">
                <h3 className="text-2xl font-semibold text-gray-700 mb-4 flex items-center space-x-2">
                  <GitPullRequest className="w-6 h-6 text-blue-600" />
                  <span>常見面試問題與範例回答</span>
                </h3>
                <ul className="list-disc list-inside text-gray-600 space-y-2">
                  <li>**自己紹介（自我介紹）:** 清晰表達您的背景與優勢。</li>
                  <li>**志望動機（應徵動機）:** 展現您對公司的熱情與理解。</li>
                  <li>**転職理由（轉職原因）:** 合理說明您的職業發展考量。</li>
                  <li>**長所・短所（優缺點）:** 真誠表達並展現改進意願。</li>
                  <li>**ストレス対処法（壓力應對）:** 如何在高壓下保持高效。</li>
                  <li>**将来の展望（未來展望）:** 您對未來職涯的規劃。</li>
                  <li>**逆質問（提問環節）:** 展現您對公司的興趣與思考。</li>
                </ul>
              </div>

              {/* Etiquette */}
              <div className="bg-purple-50 p-6 rounded-lg shadow-md border-l-4 border-purple-500">
                <h3 className="text-2xl font-semibold text-gray-700 mb-4 flex items-center space-x-2">
                  <Award className="w-6 h-6 text-purple-600" />
                  <span>面試禮儀與注意事項</span>
                </h3>
                <ul className="list-disc list-inside text-gray-600 space-y-2">
                  <li>**服装・身だしなみ（服裝儀容）:** 專業且得體。</li>
                  <li>**挨拶（問候語）:** 禮貌且清晰。</li>
                  <li>**入退室のマナー（進出場禮儀）:** 細節決定印象。</li>
                  <li>**非言語コミュニケーション（非語言溝通）:** 眼神交流與肢體語言。</li>
                </ul>
              </div>

              {/* Industry Specific */}
              <div className="bg-green-50 p-6 rounded-lg shadow-md border-l-4 border-green-500">
                <h3 className="text-2xl font-semibold text-gray-700 mb-4 flex items-center space-x-2">
                  <Lightbulb className="w-6 h-6 text-green-600" />
                  <span>產業別面試重點</span>
                </h3>
                <ul className="list-disc list-inside text-gray-600 space-y-2">
                  <li>**IT 產業:** 強調技術能力、解決問題能力與團隊合作。</li>
                  <li>**貿易產業:** 側重國際觀、溝通能力與契約知識。</li>
                  <li>**服務業:** 著重顧客導向、應變能力與服務熱忱。</li>
                  <li>**製造業:** 關注專業知識、品質意識與改善精神。</li>
                </ul>
              </div>
            </div>
          </div>
        );
      case 'vocabulary':
        return (
          <div className="p-6 bg-white rounded-lg shadow-lg">
            <h2 className="text-3xl font-bold text-gray-800 mb-6 flex items-center space-x-3">
              <Book className="w-8 h-8 text-indigo-600" />
              <span>用詞用具準備</span>
            </h2>
            <p className="text-gray-600 mb-6">學習日文商務敬語與常用詞彙，讓您的表達更專業！</p>

            <div className="space-y-8">
              {/* Keigo */}
              <div className="bg-yellow-50 p-6 rounded-lg shadow-md border-l-4 border-yellow-500">
                <h3 className="text-2xl font-semibold text-gray-700 mb-4 flex items-center space-x-2">
                  <UserCheck className="w-6 h-6 text-yellow-600" />
                  <span>敬語用法精解</span>
                </h3>
                <ul className="list-disc list-inside text-gray-600 space-y-2">
                  <li>**尊敬語 (Sonkeigo):** 提升對方地位的詞語。 (例: 行く → いらっしゃる)</li>
                  <li>**謙譲語 (Kenjougo):** 降低自己地位的詞語。 (例: 行く → 伺う)</li>
                  <li>**丁寧語 (Teineigo):** 禮貌的普通語，結尾使用「です/ます」。</li>
                  <li>**商務敬語範例:** 學習如何在職場情境下使用敬語。</li>
                </ul>
              </div>

              {/* Business Vocab */}
              <div className="bg-red-50 p-6 rounded-lg shadow-md border-l-4 border-red-500">
                <h3 className="text-2xl font-semibold text-gray-700 mb-4 flex items-center space-x-2">
                  <MessageSquare className="w-6 h-6 text-red-600" />
                  <span>常用日文商務詞彙</span>
                </h3>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-gray-600">
                  <div>
                    <h4 className="font-medium text-gray-700 mb-2">辦公室用語:</h4>
                    <ul className="list-disc list-inside">
                      <li>お世話になります (受您照顧了)</li>
                      <li>承知いたしました (我明白了)</li>
                      <li>恐れ入りますが (不好意思，麻煩您了)</li>
                      <li>取り急ぎ (暫且、趕緊)</li>
                    </ul>
                  </div>
                  <div>
                    <h4 className="font-medium text-gray-700 mb-2">會議與報告:</h4>
                    <ul className="list-disc list-inside">
                      <li>議事録 (會議記錄)</li>
                      <li>共有 (共享)</li>
                      <li>課題 (課題)</li>
                      <li>結論 (結論)</li>
                    </ul>
                  </div>
                </div>
              </div>

              {/* Interview Phrases */}
              <div className="bg-teal-50 p-6 rounded-lg shadow-md border-l-4 border-teal-500">
                <h3 className="text-2xl font-semibold text-gray-700 mb-4 flex items-center space-x-2">
                  <Calendar className="w-6 h-6 text-teal-600" />
                  <span>面試常用句型</span>
                </h3>
                <ul className="list-disc list-inside text-gray-600 space-y-2">
                  <li>本日はお忙しいところ、お時間をいただき、誠にありがとうございます。 (感謝您在百忙之中撥冗。)</li>
                  <li>〜について、ご質問させていただいてもよろしいでしょうか。 (關於〜，我可以提問嗎？)</li>
                  <li>御社に貢献できるよう、精一杯努めさせていただきます。 (我將盡力為貴公司做出貢獻。)</li>
                </ul>
              </div>
            </div>
          </div>
        );
      case 'resume-review':
        return (
          <div className="p-6 bg-white rounded-lg shadow-lg">
            <h2 className="text-3xl font-bold text-gray-800 mb-6 flex items-center space-x-3">
              <FileText className="w-8 h-8 text-indigo-600" />
              <span>履歷審核與 AI 摘要</span>
            </h2>
            <p className="text-gray-600 mb-6">
              上傳您的日文履歷，讓 AI 協助您快速摘要關鍵資訊，並進行初步檢視。
            </p>

            <div className="mb-6">
              <label htmlFor="resumeUpload" className="block text-gray-700 text-sm font-bold mb-2">
                上傳履歷文件 (.txt 或 .pdf)
              </label>
              <input
                type="file"
                id="resumeUpload"
                accept=".txt, .pdf"
                onChange={handleFileUpload}
                className="block w-full text-sm text-gray-500
                           file:mr-4 file:py-2 file:px-4
                           file:rounded-full file:border-0
                           file:text-sm file:font-semibold
                           file:bg-indigo-50 file:text-indigo-700
                           hover:file:bg-indigo-100 cursor-pointer"
              />
              <p className="mt-2 text-sm text-gray-500">
                {resumeText ? `已載入 ${resumeText.length} 字元的履歷內容。` : '請選擇一個文件。'}
              </p>
            </div>

            <button
              onClick={simulateAiSummary}
              disabled={!resumeText || isLoadingSummary}
              className={`px-6 py-3 rounded-full text-white font-semibold shadow-md transition-all duration-300 transform ${
                !resumeText || isLoadingSummary
                  ? 'bg-gray-400 cursor-not-allowed'
                  : 'bg-indigo-600 hover:bg-indigo-700 hover:scale-105'
              } flex items-center space-x-2`}
            >
              {isLoadingSummary ? (
                <>
                  <span className="animate-spin mr-2">⚙️</span> 處理中...
                </>
              ) : (
                <>
                  <Send className="w-5 h-5" />
                  <span>AI 摘要履歷</span>
                </>
              )}
            </button>

            {isLoadingSummary && (
              <p className="mt-4 text-blue-600 animate-pulse">AI 正在努力分析您的履歷中...</p>
            )}

            {aiSummary && (
              <div className="mt-8 p-6 bg-gray-50 border border-gray-200 rounded-lg shadow-inner">
                <h3 className="text-2xl font-bold text-gray-700 mb-4 flex items-center space-x-2">
                  <FileText className="w-6 h-6 text-gray-600" />
                  <span>AI 摘要結果</span>
                </h3>
                <pre className="whitespace-pre-wrap font-sans text-gray-700 text-lg leading-relaxed bg-white p-4 rounded-md border border-dashed border-gray-300">
                  {aiSummary}
                </pre>
                <p className="mt-4 text-sm text-red-600">
                  **重要提示:** 此為模擬 AI 摘要。實際應用中，請務必人工審閱 AI 產生的摘要，並根據您的需求進行修改。
                </p>
              </div>
            )}
            <p className="mt-6 text-sm text-gray-500">您的使用者 ID: <span className="font-mono text-gray-700 bg-gray-100 p-1 rounded">{userId}</span></p>
          </div>
        );
      case 'consultation':
        return (
          <div className="p-6 bg-white rounded-lg shadow-lg">
            <h2 className="text-3xl font-bold text-gray-800 mb-6 flex items-center space-x-3">
              <Calendar className="w-8 h-8 text-indigo-600" />
              <span>預約免費諮詢 (15 分鐘)</span>
            </h2>
            <p className="text-gray-600 mb-6">
              填寫下方表單，預約 15 分鐘免費諮詢，讓專業顧問為您提供一對一指導。
            </p>

            {showConsultationConfirmation ? (
              <div className="p-6 bg-green-100 text-green-800 rounded-lg shadow-md mb-6 flex items-center space-x-3 animate-fade-in">
                <CheckCircle className="w-6 h-6" />
                <p className="font-semibold">預約成功！我們將盡快與您聯繫確認。</p>
              </div>
            ) : (
              <form onSubmit={handleConsultationSubmit} className="space-y-6">
                <div>
                  <label htmlFor="name" className="block text-gray-700 text-sm font-bold mb-2">
                    <UserIcon className="inline-block mr-2" size={16}/>姓名:
                  </label>
                  <input
                    type="text"
                    id="name"
                    name="name"
                    value={consultationForm.name}
                    onChange={handleConsultationFormChange}
                    required
                    className="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"
                    placeholder="請輸入您的姓名"
                  />
                </div>

                <div>
                  <label htmlFor="email" className="block text-gray-700 text-sm font-bold mb-2">
                    <Mail className="inline-block mr-2" size={16}/>Email:
                  </label>
                  <input
                    type="email"
                    id="email"
                    name="email"
                    value={consultationForm.email}
                    onChange={handleConsultationFormChange}
                    required
                    className="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"
                    placeholder="請輸入您的 Email 地址"
                  />
                </div>

                <div>
                  <label htmlFor="topic" className="block text-gray-700 text-sm font-bold mb-2">
                    <Book className="inline-block mr-2" size={16}/>諮詢主題:
                  </label>
                  <select
                    id="topic"
                    name="topic"
                    value={consultationForm.topic}
                    onChange={handleConsultationFormChange}
                    className="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"
                  >
                    <option value="面試技巧">面試技巧</option>
                    <option value="履歷審核">履歷審核</option>
                    <option value="職涯規劃">職涯規劃</option>
                    <option value="其他">其他</option>
                  </select>
                </div>

                <div>
                  <label htmlFor="date" className="block text-gray-700 text-sm font-bold mb-2">
                    <Calendar className="inline-block mr-2" size={16}/>希望預約日期:
                  </label>
                  <input
                    type="date"
                    id="date"
                    name="date"
                    value={consultationForm.date}
                    onChange={handleConsultationFormChange}
                    required
                    className="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"
                  />
                </div>

                <div>
                  <label htmlFor="time" className="block text-gray-700 text-sm font-bold mb-2">
                    <Clock className="inline-block mr-2" size={16}/>希望預約時間:
                  </label>
                  <input
                    type="time"
                    id="time"
                    name="time"
                    value={consultationForm.time}
                    onChange={handleConsultationFormChange}
                    required
                    className="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"
                  />
                </div>

                <button
                  type="submit"
                  className="w-full px-6 py-3 bg-indigo-600 text-white font-semibold rounded-full shadow-md hover:bg-indigo-700 transition-all duration-300 transform hover:scale-105 flex items-center justify-center space-x-2"
                >
                  <Send className="w-5 h-5" />
                  <span>提交預約申請</span>
                </button>
              </form>
            )}
          </div>
        );
      default:
        return null;
    }
  };

  return (
    <div className="min-h-screen bg-gray-100 font-inter antialiased flex flex-col">
      {/* Tailwind CSS CDN */}
      <script src="https://cdn.tailwindcss.com"></script>
      {/* Google Fonts - Inter */}
      <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />

      {/* Main Container */}
      <div className="container mx-auto p-4 flex-grow flex flex-col">
        {/* Header/Navigation */}
        <header className="bg-white rounded-xl shadow-lg p-6 mb-6 flex flex-col md:flex-row items-center justify-between">
          <div className="flex items-center mb-4 md:mb-0">
            <img src="https://placehold.co/40x40/4F46E5/FFFFFF?text=JP" alt="Logo" className="w-10 h-10 rounded-full mr-3" />
            <h1 className="text-2xl font-bold text-gray-800">日文面試準備站</h1>
          </div>
          <nav>
            <ul className="flex flex-wrap justify-center md:space-x-6 space-x-2">
              <li>
                <button
                  onClick={() => setCurrentPage('home')}
                  className={`px-4 py-2 rounded-full text-sm font-medium transition-colors duration-200 ${
                    currentPage === 'home' ? 'bg-indigo-600 text-white' : 'text-gray-700 hover:bg-gray-100'
                  }`}
                >
                  首頁
                </button>
              </li>
              {user && ( // Only show navigation links if user is logged in
                <>
                  <li>
                    <button
                      onClick={() => setCurrentPage('interview-prep')}
                      className={`px-4 py-2 rounded-full text-sm font-medium transition-colors duration-200 ${
                        currentPage === 'interview-prep' ? 'bg-indigo-600 text-white' : 'text-gray-700 hover:bg-gray-100'
                      }`}
                    >
                      面試精華
                    </button>
                  </li>
                  <li>
                    <button
                      onClick={() => setCurrentPage('vocabulary')}
                      className={`px-4 py-2 rounded-full text-sm font-medium transition-colors duration-200 ${
                        currentPage === 'vocabulary' ? 'bg-indigo-600 text-white' : 'text-gray-700 hover:bg-gray-100'
                      }`}
                    >
                      用詞用具
                    </button>
                  </li>
                  <li>
                    <button
                      onClick={() => setCurrentPage('resume-review')}
                      className={`px-4 py-2 rounded-full text-sm font-medium transition-colors duration-200 ${
                        currentPage === 'resume-review' ? 'bg-indigo-600 text-white' : 'text-gray-700 hover:bg-gray-100'
                      }`}
                    >
                      履歷審核
                    </button>
                  </li>
                  <li>
                    <button
                      onClick={() => setCurrentPage('consultation')}
                      className={`px-4 py-2 rounded-full text-sm font-medium transition-colors duration-200 ${
                        currentPage === 'consultation' ? 'bg-indigo-600 text-white' : 'text-gray-700 hover:bg-gray-100'
                      }`}
                    >
                      免費諮詢
                    </button>
                  </li>
                </>
              )}
            </ul>
          </nav>
          <div className="flex items-center space-x-4 mt-4 md:mt-0">
            {user ? (
              <div className="flex items-center space-x-2">
                {user.photoURL && (
                  <img src={user.photoURL} alt="User Avatar" className="w-8 h-8 rounded-full" />
                )}
                <span className="text-gray-700 text-sm font-medium hidden sm:block">
                  {user.displayName || user.email}
                </span>
                <button
                  onClick={handleSignOut}
                  className="px-4 py-2 bg-gray-200 text-gray-700 rounded-full text-sm font-medium hover:bg-gray-300 transition-colors duration-200 flex items-center space-x-1"
                >
                  <LogOut className="w-4 h-4" />
                  <span>登出</span>
                </button>
              </div>
            ) : (
              <button
                onClick={handleGoogleSignIn}
                className="px-4 py-2 bg-indigo-600 text-white rounded-full text-sm font-medium hover:bg-indigo-700 transition-colors duration-200 flex items-center space-x-1"
              >
                <LogIn className="w-4 h-4" />
                <span>登入</span>
              </button>
            )}
          </div>
        </header>

        {/* Main Content Area */}
        <main className="flex-grow flex items-center justify-center p-4">
          <div className="w-full max-w-4xl">{renderContent()}</div> {/* Render content conditionally */}
        </main>

        {/* Footer (Optional) */}
        <footer className="text-center text-gray-500 text-sm mt-6 p-4">
          © {new Date().getFullYear()} 日文面試準備站. 版權所有。
        </footer>
      </div>
    </div>
  );
}

export default App;

// Lucide React Icons (included for completeness)
const CheckCircle = (props) => (
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="24"
    height="24"
    viewBox="0 0 24 24"
    fill="none"
    stroke="currentColor"
    strokeWidth="2"
    strokeLinecap="round"
    strokeLinejoin="round"
    {...props}
  >
    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
    <polyline points="22 4 12 14.01 9 11.01" />
  </svg>
);

const ArrowRight = (props) => (
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="24"
    height="24"
    viewBox="0 0 24 24"
    fill="none"
    stroke="currentColor"
    strokeWidth="2"
    strokeLinecap="round"
    strokeLinejoin="round"
    {...props}
  >
    <path d="M5 12h14" />
    <path d="m12 5 7 7-7 7" />
  </svg>
);
